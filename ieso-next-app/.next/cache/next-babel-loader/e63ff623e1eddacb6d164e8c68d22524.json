{"ast":null,"code":"import { MongoClient } from 'mongodb';\nconst uri = \"mongodb://mongo:27017\";\nconst client = new MongoClient(uri);\nexport default (async (req, res) => {\n  let page = req.body.page;\n  await client.connect();\n  const database = client.db(\"posts\");\n  const collection = database.collection(\"posts\");\n  let posts = await collection.find().sort({\n    timestamp: -1\n  }).limit(10).skip(page * 10).toArray();\n  posts = posts.map(post => {\n    if (post.public_private === \"private\") {\n      delete post.username;\n    }\n\n    return post;\n  });\n  req.statusCode = 200;\n  res.send(posts);\n});","map":{"version":3,"sources":["/usr/src/app/pages/api/getPosts.js"],"names":["MongoClient","uri","client","req","res","page","body","connect","database","db","collection","posts","find","sort","timestamp","limit","skip","toArray","map","post","public_private","username","statusCode","send"],"mappings":"AAAA,SAASA,WAAT,QAA4B,SAA5B;AACA,MAAMC,GAAG,GAAG,uBAAZ;AACA,MAAMC,MAAM,GAAG,IAAIF,WAAJ,CAAgBC,GAAhB,CAAf;AAEA,gBAAe,OAAOE,GAAP,EAAYC,GAAZ,KAAoB;AACjC,MAAIC,IAAI,GAAGF,GAAG,CAACG,IAAJ,CAASD,IAApB;AACA,QAAMH,MAAM,CAACK,OAAP,EAAN;AACA,QAAMC,QAAQ,GAAGN,MAAM,CAACO,EAAP,CAAU,OAAV,CAAjB;AACA,QAAMC,UAAU,GAAGF,QAAQ,CAACE,UAAT,CAAoB,OAApB,CAAnB;AACA,MAAIC,KAAK,GAAG,MAAMD,UAAU,CAACE,IAAX,GAAkBC,IAAlB,CAAuB;AAACC,IAAAA,SAAS,EAAE,CAAC;AAAb,GAAvB,EAAwCC,KAAxC,CAA8C,EAA9C,EAAkDC,IAAlD,CAAuDX,IAAI,GAAG,EAA9D,EAAkEY,OAAlE,EAAlB;AACAN,EAAAA,KAAK,GAAGA,KAAK,CAACO,GAAN,CAAUC,IAAI,IAAI;AACxB,QAAIA,IAAI,CAACC,cAAL,KAAwB,SAA5B,EAAuC;AACrC,aAAOD,IAAI,CAACE,QAAZ;AACD;;AACD,WAAOF,IAAP;AACD,GALO,CAAR;AAMAhB,EAAAA,GAAG,CAACmB,UAAJ,GAAiB,GAAjB;AACAlB,EAAAA,GAAG,CAACmB,IAAJ,CAASZ,KAAT;AACD,CAdD","sourcesContent":["import { MongoClient } from 'mongodb'\nconst uri = \"mongodb://mongo:27017\";\nconst client = new MongoClient(uri);\n\nexport default async (req, res) => {\n  let page = req.body.page\n  await client.connect()\n  const database = client.db(\"posts\")\n  const collection = database.collection(\"posts\")\n  let posts = await collection.find().sort({timestamp: -1}).limit(10).skip(page * 10).toArray()\n  posts = posts.map(post => {\n    if (post.public_private === \"private\") {\n      delete post.username\n    }\n    return post\n  })\n  req.statusCode = 200\n  res.send(posts)\n}"]},"metadata":{},"sourceType":"module"}