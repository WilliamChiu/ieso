{"ast":null,"code":"import bcrypt from 'bcrypt';\nimport { MongoClient } from 'mongodb';\nconst uri = \"mongodb://mongo:27017\";\nconst SALT_ROUNDS = 12;\nconst client = new MongoClient(uri);\n\nconst handleGet = async (body, username, password, method, res) => {\n  res.statusCode = 200;\n  res.setHeader('Content-Type', 'application/json');\n  res.end(JSON.stringify({\n    body: \"yeet\"\n  }));\n};\n\nconst handlePost = async (body, username, password, method, res) => {\n  await client.connect();\n  const database = client.db(\"accounts\");\n  const collection = database.collection(\"users\");\n  let hash = await bcrypt.hash(password, SALT_ROUNDS);\n  const user = {\n    username,\n    hash\n  };\n  const result = await collection.insertOne(user);\n  console.log(result);\n  res.statusCode = 200;\n  res.setHeader('Content-Type', 'application/json');\n  res.end(JSON.stringify(result));\n};\n\nexport default (async ({\n  body: {\n    username,\n    password\n  },\n  method\n}, res) => {\n  if (method !== \"POST\" && method !== \"GET\") {\n    res.statusCode = 405;\n    res.setHeader('Content-Type', 'application/json');\n    res.end(JSON.stringify({\n      message: \"Register only accepts GET or POST requests\"\n    }));\n  } else if (method === \"GET\") await handleGet(body, username, password, method, res);else await handlePost(body, username, password, method, res);\n});","map":{"version":3,"sources":["/usr/src/app/pages/api/auth/register.js"],"names":["bcrypt","MongoClient","uri","SALT_ROUNDS","client","handleGet","body","username","password","method","res","statusCode","setHeader","end","JSON","stringify","handlePost","connect","database","db","collection","hash","user","result","insertOne","console","log","message"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AACA,SAASC,WAAT,QAA4B,SAA5B;AAEA,MAAMC,GAAG,GAAG,uBAAZ;AAEA,MAAMC,WAAW,GAAG,EAApB;AAEA,MAAMC,MAAM,GAAG,IAAIH,WAAJ,CAAgBC,GAAhB,CAAf;;AAEA,MAAMG,SAAS,GAAG,OAAOC,IAAP,EAAaC,QAAb,EAAuBC,QAAvB,EAAiCC,MAAjC,EAAyCC,GAAzC,KAAiD;AACjEA,EAAAA,GAAG,CAACC,UAAJ,GAAiB,GAAjB;AACAD,EAAAA,GAAG,CAACE,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACAF,EAAAA,GAAG,CAACG,GAAJ,CAAQC,IAAI,CAACC,SAAL,CAAe;AAACT,IAAAA,IAAI,EAAE;AAAP,GAAf,CAAR;AACD,CAJD;;AAMA,MAAMU,UAAU,GAAG,OAAOV,IAAP,EAAaC,QAAb,EAAuBC,QAAvB,EAAiCC,MAAjC,EAAyCC,GAAzC,KAAiD;AAClE,QAAMN,MAAM,CAACa,OAAP,EAAN;AACA,QAAMC,QAAQ,GAAGd,MAAM,CAACe,EAAP,CAAU,UAAV,CAAjB;AACA,QAAMC,UAAU,GAAGF,QAAQ,CAACE,UAAT,CAAoB,OAApB,CAAnB;AAEA,MAAIC,IAAI,GAAG,MAAMrB,MAAM,CAACqB,IAAP,CAAYb,QAAZ,EAAsBL,WAAtB,CAAjB;AAEA,QAAMmB,IAAI,GAAG;AAAEf,IAAAA,QAAF;AAAYc,IAAAA;AAAZ,GAAb;AACA,QAAME,MAAM,GAAG,MAAMH,UAAU,CAACI,SAAX,CAAqBF,IAArB,CAArB;AAEAG,EAAAA,OAAO,CAACC,GAAR,CAAYH,MAAZ;AACAb,EAAAA,GAAG,CAACC,UAAJ,GAAiB,GAAjB;AACAD,EAAAA,GAAG,CAACE,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACAF,EAAAA,GAAG,CAACG,GAAJ,CAAQC,IAAI,CAACC,SAAL,CAAeQ,MAAf,CAAR;AACD,CAdD;;AAgBA,gBAAe,OAAO;AAACjB,EAAAA,IAAI,EAAE;AAACC,IAAAA,QAAD;AAAWC,IAAAA;AAAX,GAAP;AAA6BC,EAAAA;AAA7B,CAAP,EAA6CC,GAA7C,KAAqD;AAClE,MAAID,MAAM,KAAK,MAAX,IAAqBA,MAAM,KAAK,KAApC,EAA2C;AACzCC,IAAAA,GAAG,CAACC,UAAJ,GAAiB,GAAjB;AACAD,IAAAA,GAAG,CAACE,SAAJ,CAAc,cAAd,EAA8B,kBAA9B;AACAF,IAAAA,GAAG,CAACG,GAAJ,CAAQC,IAAI,CAACC,SAAL,CAAe;AAACY,MAAAA,OAAO,EAAE;AAAV,KAAf,CAAR;AACD,GAJD,MAKK,IAAIlB,MAAM,KAAK,KAAf,EAAsB,MAAMJ,SAAS,CAACC,IAAD,EAAOC,QAAP,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAmCC,GAAnC,CAAf,CAAtB,KACA,MAAMM,UAAU,CAACV,IAAD,EAAOC,QAAP,EAAiBC,QAAjB,EAA2BC,MAA3B,EAAmCC,GAAnC,CAAhB;AACN,CARD","sourcesContent":["import bcrypt from 'bcrypt'\nimport { MongoClient } from 'mongodb'\n\nconst uri = \"mongodb://mongo:27017\";\n\nconst SALT_ROUNDS = 12\n\nconst client = new MongoClient(uri);\n\nconst handleGet = async (body, username, password, method, res) => {\n  res.statusCode = 200\n  res.setHeader('Content-Type', 'application/json')\n  res.end(JSON.stringify({body: \"yeet\"}))\n}\n\nconst handlePost = async (body, username, password, method, res) => {\n  await client.connect()\n  const database = client.db(\"accounts\")\n  const collection = database.collection(\"users\")\n\n  let hash = await bcrypt.hash(password, SALT_ROUNDS)\n\n  const user = { username, hash };\n  const result = await collection.insertOne(user);\n\n  console.log(result)\n  res.statusCode = 200\n  res.setHeader('Content-Type', 'application/json')\n  res.end(JSON.stringify(result))\n}\n\nexport default async ({body: {username, password}, method}, res) => {\n  if (method !== \"POST\" && method !== \"GET\") {\n    res.statusCode = 405\n    res.setHeader('Content-Type', 'application/json')\n    res.end(JSON.stringify({message: \"Register only accepts GET or POST requests\"}))\n  }\n  else if (method === \"GET\") await handleGet(body, username, password, method, res)\n  else await handlePost(body, username, password, method, res)\n}"]},"metadata":{},"sourceType":"module"}